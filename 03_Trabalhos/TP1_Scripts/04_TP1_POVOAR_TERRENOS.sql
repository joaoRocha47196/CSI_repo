--=============
-- Ligação à BD
--=============
\set dataBase my_gis_world
;
\set userName postgres
;
\connect :dataBase :userName
--==========================
--==========================


-- Eliminar Dados (anteriores)
--=============================
DELETE FROM gps_ponto;
DELETE FROM TERRENO;
DELETE FROM TIPO_TERRENO;
DELETE FROM rota;
DROP VIEW IF EXISTS V_POLIGONO;
DROP VIEW IF EXISTS V_LINHA_CONTORNO;
DROP VIEW IF EXISTS V_ROTA_CONTORNO;

---------------------------------


----------------------------
-- Povoar Dados
----------------------------
-- TIPO_TERRENO
----------------------------
INSERT INTO tipo_terreno( nome )
VALUES
    ('Mundo'),
    ('Montanha'),
    ('Planicie'),
    ('Deserto'),
    ('Vale'),
    ('Floresta'),
    ('Rio')
;

----------------------------
-- TERRENO
----------------------------
INSERT INTO terreno( id_terreno, nome, hierarquia)
VALUES
    (0, 'Mundo', 0),

    (1, 'Montanha', 1),
    (2, 'Floresta', 2),
    (3, 'Rio', 3),

    (4, 'Planicie', 1),
    (5, 'Floresta', 2),
    (6, 'Deserto', 3),
    (7, 'Rio', 4)
;


----------------------------
-- GPS_PONTO
----------------------------

--<COMPLETAR EXPORTANDO OS VALORES DO QGIS>
INSERT INTO ROTA VALUES
    (0, 'POINT(10 10)'),
    (1,'POINT(12.776987241342567 9.189125454796127)'),
    (2,'POINT(14.918300527465181 10.322761900390446)'),
    (3,'POINT(17.059613813587795 11.45639834598478)'),
    (4,'POINT(18.067290654116082 13.219832816909275)'),
    (5,'POINT(18.067290654116082 14.983267287833783)'),
    (6,'POINT(17.311533023719864 16.49478254862622)'),
    (7,'POINT(16.429815788257613 18.006297809418655)'),
    (8,'POINT(16.17789657812554 19.64377267527712)'),
    (9,'POINT(17.689411838917973 20.65144951580541)'),
    (10,'POINT(18.69708867944626 21.78508596139973)'),
    (11,'POINT(18.571129074380227 23.54852043232424)'),
    (12,'POINT(17.689411838917973 24.304278062720456)'),
    (13,'POINT(16.681734998389686 25.437914508314776)'),
    (14,'POINT(16.681734998389686 27.327308584305314)'),
    (15,'POINT(17.563452233851937 29.090743055229822)'),
    (16,'POINT(17.689411838917973 30.85417752615433)'),
    (17,'POINT(16.807694603455722 32.491652392012796)'),
    (18,'POINT(15.674058157861396 34.50700607306938)'),
    (19,'POINT(16.429815788257613 36.522359754125944)'),
    (20,'POINT(17.689411838917973 37.65599619972028)'),
    (21,'POINT(16.807694603455722 39.41943067064477)'),
    (22,'POINT(15.674058157861396 41.43478435170135)'),
    (23,'POINT(16.17789657812554 43.828016847956036)'),
    (24,'POINT(18.067290654116082 45.33953210874847)'),
    (25,'POINT(20.08264433517266 46.97700697460694)'),
    (26,'POINT(21.34224038583302 48.2366030252673)'),
    (27,'POINT(23.23163446182356 50.50387591645595)'),
    (28,'POINT(23.735472882087706 53.023068017776666)'),
    (29,'POINT(24.869109327682025 55.16438130389928)'),
    (30,'POINT(26.632543798606534 56.927815774823785)'),
    (31,'POINT(27.262341823936715 59.698927086276576)'),
    (32,'POINT(26.002745773276352 62.218119187597296)'),
    (33,'POINT(24.36527090741788 64.35943247371992)'),
    (34,'POINT(23.105674856757524 65.87094773451234)'),
    (35,'POINT(21.720119201031128 67.5084226003708)'),
    (36,'POINT(20.460523150370765 69.14589746622929)'),
    (37,'POINT(18.949007889578333 70.90933193715378)'),
    (38,'POINT(17.185573418653828 73.0506452232764)'),
    (39,'POINT(16.55577539332365 74.56216048406884)'),
    (40,'POINT(17.059613813587795 76.70347377019144)'),
    (41,'POINT(17.689411838917973 79.09670626644612)'),
    (42,'POINT(18.571129074380227 80.98610034243667)'),
    (43,'POINT(19.70476551997455 82.4976156032291)'),
    (44,'POINT(21.216280780766983 83.50529244375738)'),
    (45,'POINT(23.105674856757524 84.13509046908757)'),
    (46,'POINT(24.869109327682025 84.38700967921964)'),
    (47,'POINT(26.254664983408425 84.13509046908757)'),
    (48,'POINT(27.13638221887068 83.00145402349324)'),
    (49,'POINT(27.640220639134817 82.4976156032291)'),
    (50,'POINT(28.270018664465 80.7341811323046)'),
    (51,'POINT(28.647897479663108 79.47458508164424)'),
    (52,'POINT(29.025776294861217 77.71115061071973)'),
    (53,'POINT(29.529614715125362 75.69579692966315)'),
    (54,'POINT(29.781533925257435 73.93236245873865)'),
    (55,'POINT(30.66325116071969 72.16892798781414)'),
    (56,'POINT(31.922847211380045 72.04296838274811)'),
    (57,'POINT(33.18244326204041 72.42084719794622)'),
    (58,'POINT(33.68628168230455 74.18428166887072)'),
    (59,'POINT(33.938200892436626 76.82943337525748)'),
    (60,'POINT(34.31607970763473 79.72650429177631)'),
    (61,'POINT(34.94587773296491 81.86781757789892)'),
    (62,'POINT(36.70931220388942 84.00913086402153)'),
    (63,'POINT(38.85062549001203 84.51296928428567)'),
    (64,'POINT(40.740019566002566 83.75721165388947)'),
    (65,'POINT(41.495777196398784 81.48993876270082)'),
    (66,'POINT(41.74769640653086 78.59286784618199)'),
    (67,'POINT(41.74769640653086 76.70347377019144)'),
    (68,'POINT(40.99193877613464 73.68044324860658)'),
    (69,'POINT(40.23618114573843 71.79104917261603)'),
    (70,'POINT(39.1025447001441 69.77569549155946)'),
    (71,'POINT(38.22082746468185 68.01226102063495)'),
    (72,'POINT(37.33911022921959 65.61902852438027)'),
    (73,'POINT(36.96123141402149 63.603674843323695)'),
    (74,'POINT(37.46506983428563 61.840240372399194)'),
    (75,'POINT(38.09486785961581 60.70660392680487)'),
    (76,'POINT(37.591029439351665 58.56529064068226)'),
    (77,'POINT(36.835271808955454 56.80185616975775)'),
    (78,'POINT(35.32375654816302 55.54226011909739)'),
    (79,'POINT(34.064160497502655 54.5345832785691)'),
    (80,'POINT(32.67860484177626 53.27498722790874)'),
    (81,'POINT(31.544968396181936 51.76347196711631)'),
    (82,'POINT(29.529614715125362 50.0000374961918)'),
    (83,'POINT(27.514261034068788 48.2366030252673)'),
    (84,'POINT(28.52193787459707 44.583774478352254)'),
    (85,'POINT(30.033453135389507 43.450138032757934)'),
    (86,'POINT(30.537291555653653 41.43478435170135)'),
    (87,'POINT(31.167089580983827 38.41175383011648)'),
    (88,'POINT(31.167089580983827 35.01084449333351)'),
    (89,'POINT(31.167089580983827 31.861854366682607)'),
    (90,'POINT(32.300726026578154 29.720541080559997)'),
    (91,'POINT(32.300726026578154 26.949429769107212)'),
    (92,'POINT(31.670928001247972 24.052358852588384)'),
    (93,'POINT(32.930524051908336 20.147611095541265)'),
    (94,'POINT(32.8045644468423 17.50245938915451)'),
    (95,'POINT(33.68628168230455 13.471752027041347)'),
    (96,'POINT(35.57567575829509 10.952559925720635)'),
    (97,'POINT(38.72466588494599 9.567004269994229)'),
    (98,'POINT(41.87365601159689 9.063165849730083)'),
    (99,'POINT(44.0149692977195 9.315085059862156)'),
    (100,'POINT(46.40820179397419 11.204479135852708)'),
    (101,'POINT(47.41587863450248 13.219832816909275)'),
    (102,'POINT(48.29759586996473 15.109226892899827)'),
    (103,'POINT(49.05335350036095 18.384176624616757)'),
    (104,'POINT(49.05335350036095 21.40720714620163)'),
    (105,'POINT(48.92739389529491 24.430237667786486)'),
    (106,'POINT(49.557191920625094 26.445591348843067)'),
    (107,'POINT(52.20234362701185 28.712864240031706)'),
    (108,'POINT(54.97345493846464 30.476298710956215)'),
    (109,'POINT(55.85517217392689 32.617611997078825)'),
    (110,'POINT(55.603252963794816 34.255086862937304)'),
    (111,'POINT(54.59557612326654 37.27811738452216)'),
    (112,'POINT(54.21769730806842 40.679026721305135)'),
    (113,'POINT(55.72921256886086 42.56842079729567)'),
    (114,'POINT(57.74456624991744 44.70973408341828)'),
    (115,'POINT(57.6186066448514 47.354885789805046)'),
    (116,'POINT(56.359010594191034 48.99236065566352)'),
    (117,'POINT(56.610929804323106 51.889431572182346)'),
    (118,'POINT(59.13012190564383 53.400946832974775)'),
    (119,'POINT(60.64163716643627 54.66054288363514)'),
    (120,'POINT(63.03486966269095 57.05377537988982)'),
    (121,'POINT(65.17618294881356 58.18741182548415)'),
    (122,'POINT(67.19153662987014 59.57296748121054)'),
    (123,'POINT(68.95497110079464 61.084482742002976)'),
    (124,'POINT(71.97800162237951 61.71428076733316)'),
    (125,'POINT(73.48951688317194 61.71428076733316)'),
    (126,'POINT(75.63083016929455 61.71428076733316)'),
    (127,'POINT(77.8981030604832 61.21044234706901)'),
    (128,'POINT(78.52790108581338 59.57296748121054)'),
    (129,'POINT(78.77982029594546 57.43165419508793)'),
    (130,'POINT(78.77982029594546 54.5345832785691)'),
    (131,'POINT(78.90577990101148 52.01539117724838)'),
    (132,'POINT(79.40961832127563 49.874077891125765)'),
    (133,'POINT(80.29133555673789 47.60680499993712)'),
    (134,'POINT(82.05477002766239 44.07993605808811)'),
    (135,'POINT(83.44032568338879 41.686703561833426)'),
    (136,'POINT(84.82588133911518 39.29347106557874)'),
    (137,'POINT(85.70759857457743 36.774278964258016)'),
    (138,'POINT(85.07780054924726 33.37336962747504)'),
    (139,'POINT(85.07780054924726 30.224379500824142)'),
    (140,'POINT(86.21143699484158 28.08306621470153)'),
    (141,'POINT(87.59699265056797 27.453268189371357)'),
    (142,'POINT(89.86426554175662 27.579227794437386)'),
    (143,'POINT(91.50174040761509 27.453268189371357)'),
    (144,'POINT(93.13921527347357 28.96478345016378)'),
    (145,'POINT(94.52477092919996 31.106096736286403)'),
    (146,'POINT(95.78436697986032 33.499329232541086)'),
    (147,'POINT(97.42184184571879 35.51468291359765)'),
    (148,'POINT(100.31891276223762 35.766602123729726)'),
    (149,'POINT(102.58618565342627 34.255086862937304)'),
    (150,'POINT(103.84578170408662 31.609935156550534)'),
    (151,'POINT(104.72749893954888 29.21670266029585)'),
    (152,'POINT(106.11305459527527 26.319631743777023)'),
    (153,'POINT(107.24669104086959 23.92639924752234)'),
    (154,'POINT(109.0101255117941 21.281247541135585)'),
    (155,'POINT(110.26972156245446 19.64377267527712)'),
    (156,'POINT(111.90719642831293 17.62841899422054)'),
    (157,'POINT(112.66295405870915 15.361146103031885)'),
    (158,'POINT(110.77355998271861 14.73134807770171)'),
    (159,'POINT(108.38032748646393 14.101550052371536)'),
    (160,'POINT(106.49093341047339 13.471752027041347)'),
    (161,'POINT(104.85345854461491 12.212155976380984)'),
    (162,'POINT(104.60153933448284 10.57468111052252)'),
    (163,'POINT(105.8611353851432 9.4410446649282)'),
    (164,'POINT(108.12840827633185 9.189125454796127)'),
    (165,'POINT(110.77355998271861 9.189125454796127)'),
    (166,'POINT(113.5446712941714 8.685287034531981)'),
    (167,'POINT(116.94558063095437 6.795892958541444)'),
    (168,'POINT(119.59073233734114 6.166094933211255)'),
    (169,'POINT(123.62143969945427 5.536296907881081)'),
    (170,'POINT(126.140631800775 5.536296907881081)'),
    (171,'POINT(128.40790469196367 5.788216118013153)'),
    (172,'POINT(131.4309352135485 6.292054538277298)'),
    (173,'POINT(134.32800613006734 7.047812168673516)'),
    (174,'POINT(135.71356178579373 8.685287034531981)'),
    (175,'POINT(136.34335981112392 10.196802295324417)'),
    (176,'POINT(138.61063270231259 12.967913606777202)'),
    (177,'POINT(140.87790559350123 14.605388472635681)'),
    (178,'POINT(143.01921887962382 15.990944128362074)'),
    (179,'POINT(143.52305729988797 18.006297809418655)'),
    (180,'POINT(140.87790559350123 18.76205543981486)'),
    (181,'POINT(138.86255191244464 18.258217019550727)'),
    (182,'POINT(135.08376376046357 16.620742153692248)'),
    (183,'POINT(131.55689481861455 15.739024918230001)'),
    (184,'POINT(130.04537955782212 17.376499784088466)'),
    (185,'POINT(130.42325837302022 19.895691885409192)'),
    (186,'POINT(133.19436968447303 21.533166751267657)'),
    (187,'POINT(137.22507704658616 23.044682012060093)'),
    (188,'POINT(141.00386519856727 25.437914508314776)'),
    (189,'POINT(143.39709769482195 28.586904634965677)'),
    (190,'POINT(143.52305729988797 30.98013713122036)'),
    (191,'POINT(141.12982480363328 33.247410022409014)'),
    (192,'POINT(138.3587134921805 34.38104646800333)'),
    (193,'POINT(135.33568297059563 36.64831935919199)'),
    (194,'POINT(132.4386120540768 38.28579422505045)'),
    (195,'POINT(130.6751775831523 39.92326909090892)'),
    (196,'POINT(129.16366232235987 41.812663166899455)'),
    (197,'POINT(128.40790469196367 43.19821882262586)'),
    (198,'POINT(127.77810666663348 45.71741092394658)'),
    (199,'POINT(127.52618745650139 48.61448184046541)'),
    (200,'POINT(127.40022785143537 50.50387591645595)'),
    (201,'POINT(126.5185106159731 53.400946832974775)'),
    (202,'POINT(125.00699535518069 55.54226011909739)'),
    (203,'POINT(122.99164167412411 58.06145222041811)'),
    (204,'POINT(122.48780325385997 60.8325635318709)'),
    (205,'POINT(124.62911653998256 62.47003839772937)'),
    (206,'POINT(125.7627529855769 63.981553658521804)'),
    (207,'POINT(125.63679338051085 66.37478615477649)'),
    (208,'POINT(124.12527811971842 67.25650339023875)'),
    (209,'POINT(121.60608601839772 68.64205904596514)'),
    (210,'POINT(119.4647727322751 70.02761470169153)'),
    (211,'POINT(119.59073233734114 71.53912996248397)'),
    (212,'POINT(118.8349747069449 73.93236245873865)'),
    (213,'POINT(116.94558063095437 75.56983732459712)'),
    (214,'POINT(114.17446931950158 76.95539298032352)'),
    (215,'POINT(111.65527721818086 77.83711021578577)'),
    (216,'POINT(108.88416590672807 78.71882745124802)'),
    (217,'POINT(107.24669104086959 79.3486254765782)'),
    (218,'POINT(105.23133735981303 80.98610034243667)'),
    (219,'POINT(103.34194328382247 82.11973678803099)'),
    (220,'POINT(100.69679157743572 83.00145402349324)'),
    (221,'POINT(98.177599476115 84.38700967921964)'),
    (222,'POINT(96.66608421532257 85.01680770454982)'),
    (223,'POINT(93.51709408867167 86.27640375521018)'),
    (224,'POINT(90.36810396202077 85.26872691468189)'),
    (225,'POINT(89.61234633162455 83.75721165388947)'),
    (226,'POINT(85.9595177847095 83.37933283869135)'),
    (227,'POINT(84.57396212898311 85.01680770454982)'),
    (228,'POINT(82.18072963272843 86.40236336027621)'),
    (229,'POINT(80.16537595167185 87.28408059573847)'),
    (230,'POINT(77.14234543008699 88.16579783120072)'),
    (231,'POINT(75.00103214396437 88.41771704133279)'),
    (232,'POINT(72.35588043757761 88.66963625146487)'),
    (233,'POINT(69.20689031092671 88.92155546159694)'),
    (234,'POINT(66.81365781467203 90.05519190719127)'),
    (235,'POINT(64.79830413361545 90.68498993252145)'),
    (236,'POINT(61.27143519176644 91.44074756291766)'),
    (237,'POINT(58.75224309044572 91.81862637811577)'),
    (238,'POINT(56.10709138405896 91.81862637811577)'),
    (239,'POINT(53.58789928273824 91.94458598318181)'),
    (240,'POINT(50.18698994595527 92.57438400851198)'),
    (241,'POINT(48.171636264898694 93.07822242877613)'),
    (242,'POINT(45.14860574331383 93.45610124397423)'),
    (243,'POINT(42.125575221728965 93.83398005917235)'),
    (244,'POINT(38.85062549001203 93.83398005917235)'),
    (245,'POINT(35.57567575829509 93.7080204541063)'),
    (246,'POINT(32.04880681644608 93.7080204541063)'),
    (247,'POINT(27.13638221887068 93.83398005917235)'),
    (248,'POINT(25.37294774794617 93.20418203384216)'),
    (249,'POINT(23.735472882087706 91.18882835278559)'),
    (250,'POINT(21.216280780766983 91.31478795785162)'),
    (251,'POINT(18.571129074380227 91.06286874771955)'),
    (252,'POINT(15.925977367993468 90.05519190719127)'),
    (253,'POINT(14.792340922399145 89.29943427679504)'),
    (254,'POINT(13.280825661606713 87.53599980587055)'),
    (255,'POINT(12.399108426144458 85.89852494001207)'),
    (256,'POINT(11.013552770418062 83.25337323362533)'),
    (257,'POINT(9.50203750962563 82.11973678803099)'),
    (258,'POINT(8.998199089361488 79.72650429177631)'),
    (259,'POINT(9.250118299493558 76.82943337525748)'),
    (260,'POINT(8.62032027416338 74.4362008790028)'),
    (261,'POINT(7.36072422350302 72.92468561821036)'),
    (262,'POINT(6.353047382974729 70.65741272702172)'),
    (263,'POINT(7.36072422350302 69.01993786116324)'),
    (264,'POINT(8.368401064031307 66.7526649699746)'),
    (265,'POINT(8.368401064031307 64.86327089398407)'),
    (266,'POINT(7.486683828569053 62.973876817993514)'),
    (267,'POINT(6.227087777908693 60.70660392680487)'),
    (268,'POINT(5.975168567776622 58.313371430550184)'),
    (269,'POINT(6.982845408304911 55.54226011909739)'),
    (270,'POINT(7.738603038701125 53.90478525323892)'),
    (271,'POINT(7.612643433635089 51.889431572182346)'),
    (272,'POINT(6.604966593106802 50.37791631138991)'),
    (273,'POINT(5.597289752578513 47.85872421006919)'),
    (274,'POINT(5.72324935764455 45.0876128986164)'),
    (275,'POINT(6.353047382974729 43.450138032757934)'),
    (276,'POINT(6.479006988040766 40.553067116239106)'),
    (277,'POINT(5.597289752578513 39.29347106557874)'),
    (278,'POINT(4.715572517116261 36.14448093892784)'),
    (279,'POINT(5.219410937380406 33.247410022409014)'),
    (280,'POINT(5.597289752578513 30.476298710956215)'),
    (281,'POINT(4.085774491786081 27.453268189371357)'),
    (282,'POINT(4.967491727248333 24.430237667786486)'),
    (283,'POINT(4.589612912050224 21.78508596139973)'),
    (284,'POINT(5.219410937380406 18.76205543981486)'),
    (285,'POINT(6.227087777908693 15.235186497965856)'),
    (286,'POINT(7.486683828569053 12.464075186513057)'),
    (287,'POINT(8.494360669097343 11.078519530786664)');




-- <MUNDO> AINDA PODE SER ALTERADO (OUTRO SHAPE)
INSERT INTO gps_ponto VALUES (0, 0, 'POINT(0 0)');
INSERT INTO gps_ponto VALUES (0, 1, 'POINT(150 0)');
INSERT INTO gps_ponto VALUES (0, 2, 'POINT(150 100)');
INSERT INTO gps_ponto VALUES (0, 3, 'POINT(0 100)');
INSERT INTO gps_ponto VALUES (0, 4, 'POINT(0 0)');


--------------------------------------------------------
--------------------------------------------------------
-- PODE VIR A SER UTIL PARA REPRESENTAR OS POLIGONOS DOS TERRENOS
--------------------------------------------------------
--------------------------------------------------------

CREATE VIEW V_LINHA_CONTORNO( g_linha, id_terreno ) AS 

( SELECT ST_MakeLine( geo_ponto ), id_terreno 
FROM ( SELECT geo_ponto, id_ordem, id_terreno 
FROM gps_ponto 
ORDER BY id_terreno, id_ordem ) AS pontos_ordenados 
GROUP BY id_terreno 
);

CREATE VIEW V_ROTA_CONTORNO(g_linha, id) AS
    ( SELECT ST_MakeLine( geo_ponto ), 1 
    FROM ( SELECT geo_ponto 
    FROM rota
    ORDER BY  id ) AS pontos_ordenados 
);

CREATE TABLE TAUX_LINHA_CONTORNO ( id SERIAL PRIMARY KEY );
SELECT AddGeometryColumn
('', 'taux_linha_contorno', 'g_linha', 0, 'LINESTRING', 2 );

INSERT INTO TAUX_LINHA_CONTORNO( g_linha )
SELECT g_linha
FROM V_ROTA_CONTORNO;


----------------------------
-- VIEW V_POLIGONO
-- 7 d
----------------------------
CREATE VIEW V_POLIGONO( id_terreno, g_poligono ) AS
SELECT id_terreno, ST_MakePolygon(g_linha)
FROM V_LINHA_CONTORNO;


UPDATE terreno
SET geo_terreno = V_POLIGONO.g_poligono
FROM V_POLIGONO
WHERE terreno.id_terreno = V_POLIGONO.id_terreno;


